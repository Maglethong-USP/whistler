CREATE OR REPLACE FUNCTION RELATORIO_USUARIOS_TOP20(DATAINIC VARCHAR, DATAFIM VARCHAR)
	RETURNS TABLE (NAME_USUARIO INTEGER, INFLUENCIA INTEGER)

AS $body$
	SELECT USUARIO.NOME AS "NAME_USUARIO", SUM((POST.COMENTARIOS * 2) + (POST.COMPARTILHAMENTOS * 2) + (POST.RANKPOS - POST.RANKNEG)) AS INFLUENCIA
	FROM USUARIO JOIN POST ON (USUARIO.ID = POST.ESCRITOR)
	WHERE POST.DATA >= TO_TIMESTAMP($1, "DD Mon YYYY") AND POST.DATA <= TO_TIMESTAMP($2, "DD Mon YYYY")
	GROUP BY (USUARIO.NOME, POST.ID, SUM((POST.COMENTARIOS * 2) + (POST.COMPARTILHAMENTOS * 2) + (POST.RANKPOS - POST.RANKNEG)))
	ORDER BY SUM((POST.COMENTARIOS * 2) + (POST.COMPARTILHAMENTOS * 2) + (POST.RANKPOS - POST.RANKNEG)) DESC
	LIMIT 20;

$body$ LANGUAGE sql;

CREATE OR REPLACE FUNCTION RELATORIO_publicações_TOP20(DATAINIC VARCHAR, DATAFIM VARCHAR)
	RETURNS TABLE (NAME_USUARIO INTEGER, INFLUENCIA INTEGER, ID_POST INTEGER, CONTEUDO VARCHAR, DATA TIMESTAMP, RANKPOS INTEGER, RANKNEG INTEGER, COMENTARIOS INTEGER, COMPARTILHAMENTO INTEGER)

AS $body$
	SELECT 
		USUARIO.NOME AS "NAME_USUARIO", 
		((POST.COMENTARIOS * 3) + (POST.COMPARTILHAMENTOS * 3) + (POST.RANKPOS * 2) + (POST.RANKNEG)) AS "INFLUENCIA"
		POST.ID AS "ID_POST",
		POST.CONTEUDO AS "CONTEUDO",
		POST.DATA AS "DATA",
		POST.RANKPOS AS "RANKPOS",
		POST.RANKNEG AS "RANKNEG",
		POST.COMENTARIOS AS "COMENTARIOS",
		POST.COMPARTILHAMENTO AS "COMPARTILHAMENTO"
		FROM USUARIO JOIN POST ON (USUARIO.ID = POST.ESCRITOR)
		WHERE POST.DATA >= TO_TIMESTAMP($1, "DD Mon YYYY") AND POST.DATA <= TO_TIMESTAMP($2, "DD Mon YYYY")
		ORDER BY ((POST.COMENTARIOS * 3) + (POST.COMPARTILHAMENTOS * 3) + (POST.RANKPOS*2) + (POST.RANKNEG)) DESC
		LIMIT 20;

$body$ LANGUAGE sql;



	